<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style/updates.css" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
        <title>VisionX Updates & Dev Logs</title>
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    </head>
    <body>
        <header>
            <div class="header-content">
                <a href="#" class="logo">
                    VisionX
                    <span class="logo-subtitle">/ Updates</span>
                </a>
                <nav class="header-nav">
                    <a href="index.html">Home</a>
                    <a href="doc.html">Docs</a>
                    <a href="updates.html" class="active">Updates</a>
                    <a href="about.html">About</a>
                    <a href="https://github.com/VissionX">GitHub</a>
                </nav>
            </div>
        </header>

        <div class="docs-layout">
            <aside class="sidebar" id="sidebar">
                <nav>
                    <div class="sidebar-section">
                        <h3 class="sidebar-title">All Updates</h3>
                        <ul class="sidebar-menu" id="sidebarList"></ul>
                    </div>
                </nav>
            </aside>

            <main class="main-content">
                <div class="content-wrapper">
                    <h1 class="page-title">VisionX Updates & Dev Logs</h1>
                    <p class="page-description">
                        Follow the journey of building an accessible voice-activated object detection tool for the visually impaired.
                    </p>

                    <div class="logs" id="logsContainer">
                        <div class="no-logs">No updates published yet — check back soon!</div>
                    </div>
                </div>
            </main>

            <aside class="toc" id="toc">
                <h3 class="toc-title">Timeline</h3>
                <ul class="toc-list" id="tocList"></ul>
            </aside>
        </div>

        <button class="mobile-toggle" id="mobileToggle" aria-label="Toggle sidebar">☰</button>

        <script>
        const mobileToggle = document.getElementById('mobileToggle');
        const sidebar = document.getElementById('sidebar');
        mobileToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            mobileToggle.textContent = sidebar.classList.contains('active') ? '×' : '☰';
        });

        const logs = JSON.parse(localStorage.getItem('visionxLogs') || '[]');
        const container = document.getElementById('logsContainer');
        const sidebarList = document.getElementById('sidebarList');
        const tocList = document.getElementById('tocList');

        if (logs.length === 0) {
            container.innerHTML = '<div class="no-logs">No updates published yet.</div>';
        } else {
            container.innerHTML = '';
            sidebarList.innerHTML = '';
            tocList.innerHTML = '';

            logs.sort((a, b) => new Date(b.date) - new Date(a.date));

            logs.forEach((log, index) => {
                const formattedDate = new Date(log.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                const logId = `log-${index}`;

                const card = document.createElement('div');
                card.className = 'log-card';
                card.id = logId;
                card.innerHTML = `
<div class="log-date">${formattedDate}</div>
<h2 class="log-title">${log.title}</h2>
<div class="log-content-wrapper">
    <div class="log-content">${marked.parse(log.content)}</div>
    <div class="fade-overlay"></div>
</div>
<button class="expand-btn" onclick="toggleExpand(this)">Read more</button>
`;
                container.appendChild(card);

                // Left sidebar - title
                const sidebarLi = document.createElement('li');
                const sidebarA = document.createElement('a');
                sidebarA.href = `#${logId}`;
                sidebarA.textContent = log.title;
                sidebarLi.appendChild(sidebarA);
                sidebarList.appendChild(sidebarLi);

                // Right TOC - date + title
                const tocLi = document.createElement('li');
                const tocA = document.createElement('a');
                tocA.href = `#${logId}`;
                tocA.textContent = `${formattedDate} — ${log.title}`;
                tocLi.appendChild(tocA);
                tocList.appendChild(tocLi);
            });

            // After rendering, check which cards need "Read more"
            document.querySelectorAll('.log-card').forEach(card => {
                const wrapper = card.querySelector('.log-content-wrapper');
                const content = card.querySelector('.log-content');
                if (content.offsetHeight > parseInt(getComputedStyle(wrapper).maxHeight)) {
                    card.classList.add('collapsed');
                } else {
                    card.querySelector('.expand-btn').style.display = 'none';
                    card.querySelector('.fade-overlay').style.display = 'none';
                }
            });
        }

        function toggleExpand(btn) {
            const card = btn.closest('.log-card');
            const wrapper = card.querySelector('.log-content-wrapper');
            const isExpanded = card.classList.contains('expanded');

            if (isExpanded) {
                card.classList.remove('expanded');
                wrapper.style.maxHeight = 'var(--max-card-height)';
                btn.textContent = 'Read more';
            } else {
                card.classList.add('expanded');
                wrapper.style.maxHeight = wrapper.scrollHeight + 'px';
                btn.textContent = 'Read less';
            }
        }

        // Smooth scrolling + active highlighting
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    if (sidebar.classList.contains('active')) {
                        sidebar.classList.remove('active');
                        mobileToggle.textContent = '☰';
                    }
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    history.pushState(null, null, this.getAttribute('href'));
                    document.querySelectorAll('.sidebar-menu a, .toc-list a').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        });

        window.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('.log-card');
            let current = '';
            sections.forEach(sec => {
                if (window.pageYOffset >= sec.offsetTop - 150) {
                    current = sec.getAttribute('id');
                }
            });
            document.querySelectorAll('.sidebar-menu a, .toc-list a').forEach(link => {
                link.classList.toggle('active', link.getAttribute('href') === `#${current}`);
            });
        });
        </script>
    </body>
</html>
